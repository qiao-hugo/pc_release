<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>列表控件属性</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" >
    <link rel="stylesheet" href="/libraries/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="leipi.style.css">
	<style>.seltext{width:136px;display:none;}</style>
    <script type="text/javascript" src="../dialogs/internal.js"></script>
    <script type="text/javascript" src="./jquery-1.7.2.min.js"></script>
<script type="text/javascript">
function createElement(type, name){     
    var element = null;     
    try {        
        element = document.createElement('<'+type+' name="'+name+'">');     
    } catch (e) {}   
    if(element==null) {     
        element = document.createElement(type);     
        element.name = name;     
    } 
    return element;
}
</script>
 
</head>
<body>
<div class="content">
    <table class="table table-striped">
    <thead>
        <tr>
            <td> 
                <span> 控件名称 ：</span> <span class="label label-important">*</span>
                <input id="orgname" placeholder="必填项" type="text" class="input-medium" value="列表控件"/> 
            </td>
            <td>
              <span>控件ID</span>  <span class="label label-important">*</span> 
              <input type="text" id="orgid" required onblur="value=value.replace(/[^\a-\z\A-\Z\0-\9\_]/g,'')" placeholder="必填项，英文小写字母数字下划线">
            </td>
        </tr>
    </thead>
</table>
		<table class="table table-striped table-bordered table-condensed"  id="tbl">
                <thead>
                    <tr>
                        <th> <span>序号</span> </th>
                        <th> <span>表头</span> </th>
                        <th> <span>类型</span> </th>
                        <th> <span>字段ID(不能重复)</span>  <span class="label label-important">*</span> </th>
                        <!--<th> <span>合计</span> <a id="showCountTips" title="在该列的底部显示该列的合计数值，数据类型只允许数值类型" rel="popover"><i class="icon-info-sign"></i></a> </th>-->
                        <th> <span>默认值</span> </th>
                    </tr>
                </thead>
                <tbody id="tbl1">
                    <tr>
                        <td><span class="badge">1</span></td>
                        <td > <input id="item_1" type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_1"  class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_1"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_1" value=""> </label> </td>
                       <!-- <td > <label> <input type="checkbox" id="sum_1" class="csum" value="1"> </label> </td>-->
                        <td ><input id="colvalue_1"  type="text" class="input-medium"/></td>
                    </tr>

                    <tr>
                        <td><span class="badge">2</span></td>
                        <td > <input id="item_2" type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_2" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                                
                            </select>
							<br><textarea class="seltext" id="seltext_2"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_2" value=""> </label> </td>
                        <!--<td > <label> <input type="checkbox" id="sum_2" class="csum" value="2"> </label> </td>-->
                        <td ><input id="colvalue_2"  type="text" class="input-medium"/></td>
                    </tr>
                    
                    <tr>
                        <td><span class="badge">3</span></td>
                        <td > <input id="item_3"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_3" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_3"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_3" value=""> </label> </td>
                       <!-- <td > <label> <input type="checkbox" id="sum_3" class="csum" value="3"> </label> </td>-->
                        <td ><input id="colvalue_3"  type="text" class="input-medium"/></td>
                    </tr>
                    <tr>
                        <td><span class="badge">4</span></td>
                        <td > <input id="item_4"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_4" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_4"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_4" value=""> </label> </td>
                        <!--<td > <label> <input type="checkbox" id="sum_4" class="csum" value="4"> </label> </td>-->
                        <td ><input id="colvalue_4"  type="text" class="input-medium"/></td>
                    </tr>
                    <tr>
                        <td><span class="badge">5</span></td>
                        <td > <input id="item_5"   type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_5" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_5"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_5" value=""> </label> </td>
<!--                        <td > <label> <input type="checkbox" id="sum_5" class="csum" value="5"> </label> </td>-->
                        <td ><input id="colvalue_5"  type="text" class="input-medium"/></td>
                    </tr>

                    <tr>
                        <td><span class="badge">6</span></td>
                        <td > <input id="item_6"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_6" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_6"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_6" value=""> </label> </td>
                       <!-- <td > <label> <input type="checkbox" id="sum_6" class="csum" value="6"> </label> </td>-->
                        <td ><input id="colvalue_6"  type="text" class="input-medium"/></td>
                    </tr>

                    <tr>
                        <td><span class="badge">7</span></td>
                        <td > <input id="item_7"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_7" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_7"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_7" value=""> </label> </td>
                        <!--<td > <label> <input type="checkbox" id="sum_7" class="csum" value="7"> </label> </td>-->
                        <td ><input id="colvalue_7"  type="text" class="input-medium"/></td>
                    </tr>

                    <tr>
                        <td><span class="badge">8</span></td>
                        <td > <input id="item_8"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_8" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_8"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_8" value=""> </label> </td>
                        <!--<td > <label> <input type="checkbox" id="sum_8" class="csum" value="8"> </label> </td>-->
                        <td ><input id="colvalue_8"  type="text" class="input-medium"/></td>
                    </tr>
                    <tr>
                        <td><span class="badge">9</span></td>
                        <td > <input id="item_9"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_9" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_9"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_9" value=""> </label> </td>
                        <!--<td > <label> <input type="checkbox" id="sum_8" class="csum" value="9"> </label> </td>-->
                        <td ><input id="colvalue_9"  type="text" class="input-medium"/></td>
                    </tr>
					<tr>
                        <td><span class="badge">10</span></td>
                        <td > <input id="item_10"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_10" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_10"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_10" value=""> </label> </td>
                        <!--<td > <label> <input type="checkbox" id="sum_10" class="csum" value="10"> </label> </td>-->
                        <td ><input id="colvalue_10"  type="text" class="input-medium"/></td>
                    </tr>
					<tr>
                        <td><span class="badge">11</span></td>
                        <td > <input id="item_11"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_11" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_11"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_11" value=""> </label> </td>
                        <!--<td > <label> <input type="checkbox" id="sum_11" class="csum" value="11"> </label> </td>-->
                        <td ><input id="colvalue_11"  type="text" class="input-medium"/></td>
                    </tr>
					<tr>
                        <td><span class="badge">12</span></td>
                        <td > <input id="item_12"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_12" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
							<br><textarea class="seltext" id="seltext_12"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_12" value=""> </label> </td>
                        <!--<td > <label> <input type="checkbox" id="sum_12" class="csum" value="12"> </label> </td>-->
                        <td ><input id="colvalue_12"  type="text" class="input-medium"/></td>
                    </tr>
					<tr>
                        <td><span class="badge">13</span></td>
                        <td > <input id="item_13"  type="text" class="input-medium itemname"> </td>
                        <td >
                            <select id="coltype_13" class="input-medium coltype">
                                <option value="text">单行输入框</option>
                                <option value="textarea">多行输入框</option>
                                <option value="int">数值</option><option title="多个选项第一个默认选中" value="select">下拉</option>
                            </select>
								<br><textarea class="seltext" id="seltext_13"  placeholder="第一个为默认值 多个选项使用回车"></textarea>
                        </td>
                        <td > <label><input type="text" class="input-medium orgid" id="unit_13" value=""> </label> </td>
                        <!--<td > <label> <input type="checkbox" id="sum_13" class="csum" value="13"> </label> </td>-->
                        <td ><input id="colvalue_13"  type="text" class="input-medium"/></td>
                    </tr>
					
                </tbody>
            </table>
        <!--div class="alert alert-danger">提示：</div-->
</div>
<script type="text/javascript">
var oNode = null,thePlugins = 'listctrl';
var rows_count = 13;
var adefaultDatatype = ['text','textarea','int','calc'];
window.onload = function() {

	$('.coltype').change(function(){
		var value_id=$(this).attr("id").replace("coltype","colvalue");
		if($(this).val()=='select'){
			$(this).next().next().show().focus();
			$("#"+value_id).val('').attr('readonly',true);
		}else{
			$(this).next().next().val('').hide();
			$("#"+value_id).val('').attr('readonly',false);
		}
	});
	
	$('.coltype').each(function(){
		
		if($(this).val()=='select'){
			alert(1);
			
		}
	})
	$('.seltext').blur(function(){
		var value_id=$(this).attr("id").replace("seltext","colvalue");
		if($(this).val()==''){
			$(this).prev().prev().val('int');
			$(this).hide();
			$("#"+value_id).val('').attr('readonly',false);
		}else{
			var a=$(this).val().split("\n");
			$("#"+value_id).val(a[0]).attr('readonly',true);
		}
	});
    //弹出窗口初始化函数，这里主要是判断是编辑下拉列表还是新增
    if( UE.plugins[thePlugins].editdom ){
        oNode = UE.plugins[thePlugins].editdom;
       
        var formdesign=oNode.getAttribute('formdesign');
		var formdesignobject=eval("("+formdesign+")");
		$G('orgname').value = formdesignobject.listname;
		$G('orgid').value = formdesignobject.name;
        var gId = formdesignobject.listid,gTitle = formdesignobject.title,gType = formdesignobject.listtype,gValue = formdesignobject.value;
        var aTitle = gTitle.split('##'),aColType = gType.split('##'),aUnit = gId.split('##'),aColValue = gValue.split('##');
        for ( var i = 0;i < aUnit.length; i++ ) {
            var sItem = 'item_' + (i + 1),
            sColtype = 'coltype_' + (i + 1),
            sUnit = 'unit_' + (i + 1),
            sNum = 'sum_' + (i + 1),
            sColValue = 'colvalue_' + (i + 1);
            $G(sItem).value = aTitle[i];
            $G(sUnit).value = aUnit[i];
            $('#' + sColtype).val(aColType[i]);
           
			if(aColType[i]=='select'){
				var v=aColValue[i].split(";");
				$('#' + sColtype).next().next().show().val(v.join("\n"));
				$('#'+sColValue).val(v[0]).attr('readonly',true);
			}else{
				$G(sColValue).value = aColValue[i];
			}
        }
    }
    //合计，强制选择 int
//  $(".csum").click(function(){if($(this).attr("checked")){var i = $(this).val();$("#coltype_"+ i).val('int');}});
}
dialog.oncancel = function () {
if( UE.plugins[thePlugins].editdom ) {
    delete UE.plugins[thePlugins].editdom;
}
};
dialog.onok = function (){
	var gName=$G('orgname').value,orgid=$G('orgid').value;
	if(gName=='' || orgid=='' ){alert('控件名称和ID必填');return false;}
    var gTitle =new Array(),gType = new Array() ,gId=new Array(),gValue =new Array(),
        nCount = 0 ;
   var tr1='<tr>',tr2='<tbody><tr>';  
    for (var i = 1;i <= rows_count; i ++ ) {
        var oItem  = $G( "item_" + i );   
        if ( oItem.value != '' && $G( 'unit_' + i).value!='') {
            if($.inArray(oItem.value,gTitle) !== -1 ){continue;}//重复
            gTitle[nCount]= oItem.value; //表头
            gType [nCount]= $G('coltype_' + i).value;
			if(gType [nCount]=='select'){
				 gValue[nCount]= $G('seltext_' + i).value.split("\n").join(";");
			}else{
				 gValue[nCount]= $G('colvalue_' + i).value;
			}
           
            if($.inArray($G( 'unit_' + i).value,gId)!='-1'){
            	alert('字段ID不能重复！');
            	return;
            }
            gId[nCount]= $G( 'unit_' + i).value; 
            tr1+='<th>'+gTitle[nCount]+'</th>';
            if(gType [nCount]=='textarea'){
            	tr2+='<td><textarea>'+ gValue[nCount]+'</textarea></td>';
            }else{
            	tr2+='<td><input value="'+ gValue[nCount]+'"></td>';
            }
            nCount ++ ;
        }//end if
    }//end for
 	
 	tr1='<p><table cellspacing="0" class="table table-bordered table-condensed" style="width: 100%;"><thead><tr><th colspan="'+(nCount+1)+'">'+gName+'</th></tr>'+tr1+'</tr></thead>'+tr2+'</tr></tbody></table></p>';;
    if ( nCount == 0 ) { alert("表头项目不能为空"); return false;}
	var formdesign='{&quot;name&quot;:&quot;'+orgid+'&quot;,&quot;title&quot;:&quot;'+gTitle.join('##')+'&quot;,&quot;value&quot;:&quot;'+gValue.join('##')+'&quot;,&quot;type&quot;:&quot;listctrl&quot;,&quot;listtype&quot;:&quot;'+gType.join('##')+'&quot;,&quot;listname&quot;:&quot;'+gName+'&quot;,&quot;listid&quot;:&quot;'+gId.join('##')+'&quot;}';
    if( !oNode ) {
        try {
            editor.execCommand('insertHtml','<span plugintype="'+thePlugins+'" style="padding:6px;display:inline-block;" formdesign="'+formdesign+'"> <input  readonly value="列表"></span>');
            return true ;
        } catch (e) {
            try {
                editor.execCommand('error');
            } catch ( e ) {
                alert('控件异常');
            }
            return false;
        }
    } else {
		formdesign='{"name":"'+orgid+'","title":"'+gTitle.join("##")+'","value":"'+gValue.join("##")+'","type":"listctrl","listtype":"'+gType.join("##")+'","listname":"'+gName+'","listid":"'+gId.join("##")+'"}';
        oNode.setAttribute('formdesign',formdesign );
        oNode.innerHTML='<input readonly value="列表">';
        delete UE.plugins[thePlugins].editdom; //使用后清空这个对象，变回新增模式
    }
};
</script>
</body>
</html>
